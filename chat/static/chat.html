<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>

    <link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

    <!-- Assumes global locations for socket.io.js and easyrtc.js -->
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/easyrtc/easyrtc.js"></script>
    <script type="text/javascript" src="/easyrtc/easyrtc_ft.js"></script>
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
</head>
<body ng-app="chat">
<div ng-cloak ng-controller="chatCtrl">
    <div id="rooms">
		<button id="addRoom" onclick="showCreateRoomForm()"><i class="fas fa-plus"></i></button>
        <ul id="roomList">
            <li ng-repeat="room in rooms track by $index">
                <span onclick="showChatInput()" ng-click="chatRoom.changeRoom($index)">
                    {{room.name}}&nbsp;
                    <span ng-if="room.unread > 0" class="redTxt">{{room.unread}}</span>
                </span>
            </li>
        </ul>
    </div>
   <!-- <div id="friends">
        <div ng-if="chatRoom.isARoomSelected()">
            <ul id="friendsList">
                <li ng-repeat="member in chatRoom.getMembers() track by $index">
                    <span ng-class="member.isOnline ? 'greenTxt' : 'redTxt'">
                        {{member.name}}
                        <span ng-if="member.isTyping === chatRoom.getSelectedRoom().id">
                            <br>(typing...)
                        </span>
                    </span>
                    <input class="redBtn" type="submit" value="Remove From Room"
                           ng-click="chatRoom.removeUser(member.id)"/>
                    <br/>
                    <span ng-if="chatClient.hasFriend(member)">
                        <input class="yellowBtn" type="submit" value="Remove Friend"
                               ng-click="chatClient.unfriend(member)"/>
                    </span>
                    <span ng-if="!chatClient.hasFriend(member)">
                        <input class="blueBtn" type="submit" value="Add Friend"
                               ng-click="chatClient.sendFriendRequest(member)"/>
                    </span>
                </li>
                <li ng-repeat="friend in chatClient.getFriends() track by $index">
                    <span ng-if="!chatRoom.hasMember(friend)">
                        {{friend.name}}
                        <input class="greenBtn" type="submit" value="Add To Room"
                               ng-click="chatRoom.addFriendAsMember(friend)"/>
                        <input class="yellowBtn" type="submit" value="Remove Room"
                               ng-click="chatClient.unfriend(friend)"/>
                    </span>
                </li>
            </ul>
        </div>
    </div>-->
    <div id="info">
        <span ng-if="chatRoom.isARoomSelected()">
            <span>{{chatRoom.getSelectedRoom().name}}</span>
            <button class="redBtn"
					ng-click="chatClient.leaveRoom(chatRoom.getSelectedRoom())"><i class="fas fa-sign-out-alt fa-2x" style="color: white;"></i></button>
        </span>
        <span ng-if="!chatRoom.isARoomSelected()">
            <span>No room selected</span>
        </span>
    </div>
    <div id="input">
		<button id="attachBtn" onclick="showAttachmentForm()" style="color: white;" class="blueBtn"><i class="fas fa-paperclip fa-2x"></i></button>
        <input id="inputBox" ng-model="chatInput">
        <button id="sendBtn"
				ng-click="chatRoom.sendChat(chatInput)"><i style="color: white" class="fas fa-paper-plane fa-2x"></i></button>    </div>
    <div id="log">
        <div ng-if="chatRoom.isARoomSelected()">
            <ul id="chatList">
                <li ng-repeat="chat in rooms[selRoomIndex].chats track by $index">
                    <span ng-if="typeof(chat) === 'string'">
						<img ng-src="https://ui-avatars.com/api/?name={{chat.split(' ')[1] + '+' + chat.substr(0, chat.indexOf(':')).split(' ')[chat.substr(0, chat.indexOf(':')).split(' ').length - 1]}}/?size=20/?rounded=true"/>
                        <span ng-class="chat.startsWith(user.uname) ? 'container darker' : 'container'">
                            {{chat}}
                        </span>
                    </span>
                    <span ng-if="typeof(chat) === 'object'">
						<img ng-src="https://ui-avatars.com/api/?name={{chat.fromName.split(' ')[0] + '+' + chat.fromName.split(' ')[chat.fromName.split(' ').length - 1]}}/?size=20/?rounded=true"/>
                        <span ng-class="chat.fromUname === user.uname ? 'container darker' : 'container'">
                            {{chat.fromUname + " " + chat.fromName}}
                            <img ng-if="chat.type.includes('image')" src="{{chat.url}}">
                            <span ng-if="!chat.type.includes('image')">{{chat.name}}</span>
                            <br/>
                            <!--<input class="greenBtn" type="submit" value="Download" ng-click="chat.download()"/>-->
                        </span>
                    </span>
                </li>
            </ul>
        </div>
    </div>
    <div id="createRoomForm">
        <input class="redBtn" type="submit" value="Cancel" onclick="closeCreateRoomForm()"/>
        <br>
        Name: <label for="createRoomName"></label><input id="createRoomName" type="text" ng-model="createRoomName">
        <br>
        Members:
        <span ng-repeat="member in createRoomFormMembers track by $index" id="createRoomMembers">
                <span ng-click="removeCreateRoomFormMember(member)">
                    {{member.name}}
                </span>
            </span>
        <br>
        <ul style="list-style: none" id="createRoomFriends">
            <li ng-repeat="friend in friends track by $index">
                <span ng-if="!createRoomFormMemberNames.includes(friend.name)">
                    <span ng-click="addCreateRoomFormMember(friend)">
                        {{friend.name}}
                    </span>
                </span>
            </li>
        </ul>
        <input class="greenBtn" type="submit" value="Create" onclick="closeCreateRoomForm()"
               ng-click="chatClient.createRoom(createRoomName, createRoomFormMembers)"/>
    </div>
	<div id="attachForm"  class="modal">
    <div class="modal-content animated fadeIn">
		<div class="modal-header">
		DROP FILE HERE
		<span id="attachCancelBtn" class="close" onclick="closeAttachmentForm()" ng-click="chatClient.clearFilesToSend()">&times;</span>
		</div>
		<div class="modal-body">
		<ul id="attachments">
            <li ng-repeat="file in filesToSend track by $index">
                {{file.name}}
            </li>
        </ul>
		</div>
		<div class="modal-footer">
			<button id="attachSendBtn" onclick="closeAttachmentForm()" ng-click="chatClient.sendCollectedFiles()" class="greenBtn" type="submit"><i class="far fa-paper-plane fa-2x"></i></button>
		</div>
    </div>
		</div>
</div>

<script src="scripts/models.js"></script>
<script src="scripts/chatClient.js"></script>
<script>
    function showCreateRoomForm() {
        $('#createRoomForm').css('display', 'block');
    }

    function closeCreateRoomForm() {
        $('#createRoomMembers').empty();
        $('#createRoomName').val('');
        $('#createRoomForm').css('display', 'none');
    }

    function showAttachmentForm() {
        $('#attachForm').css('display', 'block');
    }

    function closeAttachmentForm() {
        $('#attachForm').css('display', 'none');
    }

    function showChatInput() {
        $('#input').css('display', 'block');
    }

    function closeChatInput() {
        $('#input').css('display', 'none');
    }
</script>

</body>
</html>